<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,300;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="stylesheet.css">
</head>

<body>

    <header>
        <h1>Wather Dashboard</h1>
    </header>

    <div class="row">
        <aside class="col-md-6">
            <h2>Search for a City</h2>

            <form class="row" id="city-form">
                <input type="text" id="city-input">
                <button id="find-city" class="btn btn-primary btn-lg" type="submit">Search City</button>
            </form>

            <div id="city-log">
                <ul class="list-group">
                </ul>
            </div>

        </aside>

        <section id="cityWeatherDetails" class="col-md-6">
            <h2 id="city-name"></h2>
            <ul>
                <li id="temp"></li>
                <li id="humidity"></li>
                <li id="wind"></li>
                <li id="UV"></li>
            </ul>

        </section>

    </div>




    <!-- preivew api -->
    <!-- <div id="city-view"></div> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        $("#cityWeatherDetails").hide()
        $("#find-city").on("click", function (event) {
            $("#cityWeatherDetails").show()
            var cityName = $("#city-input").val();
            console.log(cityName)

            event.preventDefault();

            queryURL = "http://api.openweathermap.org/data/2.5/weather?q=" + cityName + "&appid=a2d1d70e63ea85ab0e1dec71d8d209c2";

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {
                console.log(response)
                // $("#city-view").text(JSON.stringify(response));
                $("#city-name").text("City: " + response.name);

                var tempF = (response.main.temp - 273.15) * 1.80 + 32;
                $("#temp").text("Temperature: " + parseInt(tempF));

                $("#humidity").text("Humidity: " + response.main.humidity);
                $("#wind").text("Wind: " + response.wind.speed);

                var lat = response.coord.lat
                var lon = response.coord.lon

                UVI(lat, lon)




                save(cityName)
                renderCityList()

            });

        });

        function UVI(lat, lon) {

            uvQueryURL = "https://api.openweathermap.org/data/2.5/onecall?lat=" + lat + "&lon=" + lon + "&appid=a2d1d70e63ea85ab0e1dec71d8d209c2";

            $.ajax({
                url: uvQueryURL,
                method: "GET"
            }).then(function (uvresponse) {
                var uvi = uvresponse.current.uvi
                $("#UV").text("UV Index: " + uvi);
            });
        }


        function save(city) {

            var history = JSON.parse(localStorage.getItem("saved-cities")) || []
            history.push(city)
            localStorage.setItem("saved-cities", JSON.stringify(history))

        }

        function renderCityList() {

            var savedData = JSON.parse(localStorage.getItem("saved-cities"))

            $(".list-group").empty()

            for (var i = 0; i < savedData.length; i++) {

                var listItem = $("<li>")
                listItem.addClass("list-group-item")
                listItem.text(savedData[i]);
                $(".list-group").append(listItem)
            }
        }

        renderCityList()


    </script>
</body>

</html>